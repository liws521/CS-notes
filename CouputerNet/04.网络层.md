# 网络层

## 网络层概述
- 网络层使用中间设备**路由器**将异构网络互联, 形成一个统一的网络, 并且将源主机发出的分组经由各种网络路径通过路由和转发, 到达目的主机
- 网络层功能
    - 分组生成和装配
    - 路由和转发
    - 拥塞控制
    - 异种网络的互联
    - 透明传输
- 网络层提供的服务
    - 面向连接的网络服务--虚电路服务, 发送数据前先建立连接, 然后在该连接上实现有次序的分组传输, 当数据交换结束后, 终止这个连接
    - 无连接的网络服务--数据报服务, 每一个发出的分组(称为一个数据报)都携带了完整的目的地址信息, 因而每一个分组都可以独立的选择路由

## 网络层协议
- 所谓虚拟互联网络, 它的意思就是互联起来的各种物理网络的异构性本来是客观存在的, 但是我们利用**IP协议**就可以使这些性能各异的网络从用户看起来好像是一个统一的网络.
- 网络层除了IP协议外, 还有4个与IP协议配套使用的协议
    - 地址解析协议ARP
    - 逆地址解析协议RARP
    - 网际控制报文协议ICMP
    - 网际组管理协议IGMP
### IP概述
- 网际协议(Internet Protocol), IP是一个无连接的协议, 在数据交换前, 主机之间并未联络, 经它处理的数据在传输时是没有保障的, 是不可靠的.
- IP协议既提供了分段功能--IP报头, 有提供寻址功能, 用以标识网络及主机节点地址(即IP地址)
### IPv4数据报格式
https://www.bilibili.com/video/BV1P44y1z7Tv?p=11
### IPv4地址
- 一个IPv4地址是32位地址, 它唯一的并通用的定义了一个连接到因特网上的主机或者路由器
- 二进制标识法, 和点分十进制标识法, 把32位每8位为一组用十进制标识, 提高对人类的可读性

- IP地址的编址方式经过了3个阶段
1. 分类的IP地址, 最基本的编址方式
    - 两级的IP地址, IP地址 = {网络号, 主机号}
    - ABCDE五类, A类8位网络号, 24位主机号, B类16+16, C类24+8
    - A, 0作为前缀, B10前缀, C110前缀, D1110前缀, E11110前缀
    - 主机号全0表示网络地址, 主机和全1表示广播地址
    - 常用的192在C类的地址范围内, D类是多播地址, E类保留为今后使用
    - 一些特殊IP地址, https://www.bilibili.com/video/BV1P44y1z7Tv?p=11, 23分钟
    - 同一个网络的网络号是相同的, 通过路由器连接其他网络号的网络
2. 子网的划分, 对分类的IP地址的改进
    - 子网划分是指由网络管理员将本单位一个给定网络分成若干个更小的部分, 这些更小的部分被称为子网(subnet)
    - IP地址 = {网络号, 子网号, 主机号}
    - 网络号部分不变, 原来的主机号部分划分为子网号+主机号
    - 子网的划分是属于本单位内部的事, 在本单位以外看不见这样的划分, 从外部看, 这个单位仍然只有一个网络号
    - 从一个IP地址并无法判断该地址时分进行了子网划分, 使用子网掩码(subnet mask)可以找出IP地址中的子网部分
    - 子网掩码中, 网络和部分和子网号部分取值1, 主机号部分为0
    - 网络地址 = IP地址 AND 子网掩码
    - 广播地址, 是专门用于同时向网络中所有工作站进行发送的一个地址, 在TCP/IP协议的网络中, 主机位全1的IP地址为广播地址
3. 构造超网, 比较新的无分类
    - 无类域间路由CIDR(构造超网), 即变长子网掩码(VLSM)的基础上发展成的无分类域间路由选择CIDR
    - CIDR消除了传统A类B类C类地址以及划分子网的概念
    - IP地址 = {网络前缀, 主机号}
    - CIDR的表示方法, 斜杆标记法, 如220.8.21.231/25, 这个25表示网络前缀的位数
- NAT--网络地址转换
    - 使用私有地址将网络连至Internet, 需要将私有地址转换为公有地址. 这个转换过程称为网络地址转换, 一种把内部私有网络地址(IP地址)翻译成合法网络IP地址的技术
    - 192.168.0.1 - 192.168.255.254 是C类地址中的私有IP地址
    
## 路由选择

## IPV6