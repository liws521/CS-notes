# 数据链路层

## 组帧
- 封装成帧(framing)就是在一段数据的前后分别添加首部和尾部, 然后就构成了一个帧.
    - 从网络层下来的IP数据报加上帧首部和帧尾部形成了一个帧
- 组帧的方法
    - 字节计数法
    - 使用字符填充的首尾定界符法
        - 数据透明性, 数据部分出现了标识需要用特殊标识转义一下
    - 使用比特填充的首尾定界符法
    - 违法编码法

## 差错控制
- 差错控制方法分两类, 一类是自动请求重发ARQ, 另一类是前向纠错FEC
- 引出来两种不同的差错控制编码, 检错码和纠错码
- 奇偶校验
    - 检错码
    - 原始数据最高位增加一个奇偶校验位使得结果中1的个数为奇数(奇校验)或偶数(偶校验)
- 循环冗余检测CRC
    - 检错码
    - 这个太熟悉了  
- 海明码
    - 纠错码
    - 数据和校验位混合在一起, 从1开始编号, 编号为2的幂的位为校验位
    - 1号位置的校验位对末尾为1的数据位进行校验, 比如3,5,7...
    - 进行的是奇偶校验
    - 如何纠错, 先将出错计数器置0, 依次对校验位进行校验, 如果出错就加上该校验位的编号, 最终出错计数器为0则正确, 否则其值则为出错的数据位

## 流量控制和可靠传输
### 流量控制
- 流量控制: 采取适当的措施, 限制发送速率, 避免由于接收方来不及接收而造成数据丢失
- 先来一下窗口的概念
    - 窗口, 可容纳数据帧的缓冲区, 在发送端和接收端分别设置发送窗口和接收窗口
    - 发送窗口用来对发送端进行流量控制, 发送窗口是发送方用来保存允许发送和已发送但尚未经确认的数据帧
    - 接收窗口是为了控制可以接受的数据帧的范围, 接收窗口是接收方用来保存已正确接收但尚未交给上层的数据帧
    - 只有在接受窗口向前滑动时(与此同时也发送了确认), 发送窗口才有可能向前滑动, 收发两端的窗口按照以上规律不断的向前滑动, 这种协议被称为滑动窗口协议
- 如何做到流量控制呢--滑动窗口协议
    - 停-等协议
        - 发送窗口=1, 接收窗口=1
        - 发送方每发送一帧后就要停下来等待接收方的确认返回, 仅当接收方正确接收并返回确认帧ACK, 发送方接收到确认帧后, 才可以发送下一帧
    - 后退N帧协议
        - 发送窗口>1, 接收窗口=1
        - 比如发送10个帧, 只有3号发送过程中出错了, 那从3号及其之后都要重传, 所以叫后退N帧, 接收窗口按序接收
    - 选择重传协议
        - 发送窗口>1, 接收窗口>1
        - 先收下发送序号不连续但仍处在接收窗口的数据帧, 等到所缺序号的数据帧收到后一起交给主机

### 可靠传输
- 确认机制
    - 接收方收到正确的帧就要向发送方发送确认
- 重传机制
    - 发送端在一定期限内没有收到确认, 就认为出现了差错, 因而就进行重传, 直到收到对方的确认为止

## 介质访问控制
- 静态划分介质访问控制: 频分复用FDM, 时分复用TDM, 波分复用, 码分复用
- 动态介质访问控制: 随机访问(CSMA/CD) 和受控访问(轮询访问介质访问控制: 令牌传递协议)
- 随机访问CSMA/CD--载波监听多路访问/冲突检测协议
    - 工作原理, 发前先侦听, 空闲即发送, 边发边检测, 冲突时退避
- 受控访问--令牌传递协议, 令牌环网
    - 令牌在环中流动, A要发消息给B, A拿令牌发消息给B, B收到并转发数据回A, A收到B转发的数据与他发出的进行比较, 如果出错交给上层处理, 没错就ok, 松开令牌

## 数据链路层设备
- 网卡
    - 又称网络适配器, 是局域网中连接计算机和传输介质的接口
    - 网络接口卡NIC也说的是它
    - 数据链路层用到的是物理地址MAC
- 网桥
    - 又称桥接器, 是连接两个局域网的一个存储/转发设备
    - 两个网桥相连的局域网属于一个局域网, 同一网段
- 交换机

## 广域网中数据链路层协议
- 点对点协议 PPP
    - 工作于数据链路层的广域网协议
- HDLC协议
    - 面向比特的数据链路层协议
    - 采用位填充方式来实现数据的透明传输
    - CRC检测